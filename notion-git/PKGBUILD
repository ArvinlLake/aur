# Maintainer: Eugen Zagorodniy e dot zagorodniy at gmail dot com
# Contributor: aunoor

pkgname=notion-git
pkgver=20110712
pkgrel=1
pkgdesc="Tabbed tiling, window manager. Fork of Ion3"
url="http://sourceforge.net/projects/notion/"
arch=('i686' 'x86_64')
license=('GPL')
depends=('glib2' 'gettext' 'lua' 'libxext' )
makedepends=('git' 'pkgconfig' )
conflicts=('ion3')
provides=('notion')

_gitroot="git://notion.git.sourceforge.net/gitroot/notion/notion"
_gitname="notion"

_gitroot2="git://notion.git.sourceforge.net/gitroot/notion/libtu"
_gitname2="libtu"

_gitroot3="git://notion.git.sourceforge.net/gitroot/notion/libextl"
_gitname3="libextl"


build() {
    cd ${srcdir}

    msg "Connecting to the git repository..."
    if [ -d ${srcdir}/${_gitname} ]; then
        cd ${_gitname}
        git pull origin
    else
        git clone --depth 1 ${_gitroot}
        cd ${_gitname}
    fi
    
    if [ -d ${srcdir}/${_gitname}/${_gitname2} ]; then
    echo
        git pull origin
    else
        git clone --depth 1 ${_gitroot2}
      echo
    fi
    
    if [ -d ${srcdir}/${_gitname}/${_gitname3} ]; then
    echo
        git pull origin
    else
        git clone --depth 1 ${_gitroot3}
    echo
    fi
    
    msg "GIT checkout done or server timeout"

    rm -rf ${srcdir}/${_gitname}-build
    cp -r  ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build
    
    cd ${srcdir}/${_gitname}-build
    
    msg "Starting make..."

    sed -e 's/^\(PREFIX=\).*$/\1\/usr/'     \
        -e 's/^\(LUA_DIR=\).*$/\1\/usr/'    \
        -e 's/^\(X11_PREFIX=\).*/\1\/usr/'  \
        -i system.mk

    make INCLUDES=-I${srcdir}/${_gitname}-build
}

package() {
    cd ${srcdir}/${_gitname}-build
    make PREFIX=${pkgdir}/usr install
}

